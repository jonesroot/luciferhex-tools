#!/data/data/com.termux/files/usr/bin/bash
source "$HOME/.luciferhex/colors.sh"

vps_file="$HOME/.luciferhex_vps_list"

main_menu() {
    clear
    echo -e "${CYAN}==========================================${RESET}"
    echo -e "     ${GREEN}Welcome to LuciferHEx Tools Termux${RESET}   "
    echo -e "${CYAN}==========================================${RESET}"
    echo ""
    echo -e "${ARROW} ${YELLOW}What do you want to do?${RESET}"
    echo ""
    echo -e "${ARROW} ${CYAN}1)${RESET} ${GREEN}Login as Termux${RESET}"
    echo -e "${ARROW} ${CYAN}2)${RESET} ${GREEN}Login as VPS${RESET}"
    echo -e "${ARROW} ${CYAN}3)${RESET} ${GREEN}Add New VPS${RESET}"
    echo -e "${ARROW} ${CYAN}4)${RESET} ${RED}Remove VPS${RESET}"
    echo -e "${ARROW} ${CYAN}x)${RESET} ${RED}Exit${RESET}"
    echo ""
    read -p "${CYAN}[>]${RESET} ${YELLOW}Please Choose Number 1-4 or x for${RESET} ${RED}Exit${RESET}${CYAN}:${RESET} " menu

    case "$menu" in
        1) echo -e "${SUCCESS} Logged in as Termux." ;;
        2) login_vps ;;
        3) add_vps ;;
        4) remove_vps ;;
        x|X) exit ;;
        *) echo -e "${FAILED} Invalid selection."; sleep 1; main_menu ;;
    esac
}

login_vps() {
    clear
    echo -e "${CYAN}==================================${RESET}"
    echo -e "     ${GREEN}List VPS on this Device${RESET}      "
    echo -e "${CYAN}==================================${RESET}"
    [[ ! -f "$vps_file" ]] && echo "No VPS found." && sleep 2 && main_menu

    i=1
    unset vps_choices
    while IFS="|" read -r name ip user pass; do
        echo "$i) $name [$ip]"
        vps_choices[$i]="$name|$ip|$user|$pass"
        ((i++))
    done < "$vps_file"

    echo "99) Back"
    read -p "${CYAN}[>]${RESET} ${YELLOW}Please Choose a number of VPS below:${RESET} " choice

    [[ "$choice" == "99" ]] && main_menu

    selected="${vps_choices[$choice]}"
    [[ -z "$selected" ]] && echo -e "${FAILED} Invalid selection." && sleep 1 && login_vps

    IFS="|" read -r name ip user pass <<< "$selected"
    echo -e "${INFO} Login to $name [$ip] as $user ..${RESET}"
    sshpass -p "$pass" ssh -tt -o StrictHostKeyChecking=no "$user@$ip"
}

add_vps() {
    echo ""
    read -p "[+] VPS Name: " name
    read -p "[+] IP VPS  : " ip
    read -p "[+] Username: " user
    read -s -p "[+] Password: " pass
    echo ""
    echo "$name|$ip|$user|$pass" >> "$vps_file"
    echo -e "${SUCCESS} VPS successfully added!"
    sleep 1
    main_menu
}

remove_vps() {
    [[ ! -f "$vps_file" ]] && echo -e "${FAILED} No VPS." && sleep 2 && main_menu
    echo -e "${YELLOW}List VPS:${RESET}"
    i=1
    unset vps_choices
    while IFS="|" read -r name ip; do
        echo "$i) $name [$ip]"
        vps_choices[$i]="$name|$ip"
        ((i++))
    done < "$vps_file"

    echo "99) Back"
    read -p "[>] Select the VPS to be deleted: " del_choice

    [[ "$del_choice" == "99" ]] && main_menu

    if [[ -n "${vps_choices[$del_choice]}" ]]; then
        sed -i "${del_choice}d" "$vps_file"
        echo -e "${SUCCESS} VPS successfully deleted."
    else
        echo -e "${FAILED} Invalid selection."
    fi
    sleep 1
    main_menu
}

cat "$HOME/.luciferhex/banner.txt"
main_menu
